// Underscore.date
//
// (c) 2011 Tim Wood
// Underscore.date is freely distributable under the terms of the MIT license.
//
// Version 0.3.0

(function(a,b,c){function q(a,b){return j[a].replace(/%d/i,b||1)}function p(d){return d===c?e.now():b.isDate(d)?d:b.isArray(d)&&d.length>2?n(d):new a(d)}function o(d){return d===c?e.now(!0):isNaN(d)?b.isDate(d)?d.getTime():b.isArray(d)&&d.length>2?n(d).getTime():(new a(d)).getTime():d}function n(b){return new a(b[0],b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0)}function m(b,c,d){var e=(b.ms||b[6]||0)+(b.s||b[5]||0)*1e3+(b.m||b[4]||0)*6e4+(b.h||b[3]||0)*36e5+(b.d||b[2]||0)*864e5+(b.w||0)*6048e5,f=(b.M||b[1]||0)+(b.y||b[0]||0)*12,g;e&&c.setMilliseconds(c.getMilliseconds()+e*d),f&&(g=c.getDate(),c.setDate(1),c.setMonth(c.getMonth()+f*d),c.setDate(Math.min((new a(c.getFullYear(),c.getMonth()+1,0)).getDate(),g)));return c}function l(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}var d=this,e,f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],j={future:"in %s",past:"%s ago",s:"less than a minute",m:"about a minute",mm:"%d minutes",h:"about an hour",hh:"about %d hours",d:"a day",dd:"%d days",M:"about a month",MM:"%d months",y:"about a year",yy:"%d years"},k=function(a){var b=a%10;return(a%100/10|0)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"};e={addTime:function(a,b){return m(b,p(a),1)},customizeDate:function(a){var c=a.weekdays,d=a.weekdaysShort,e=a.months,l=a.monthsShort,m=a.relativeTime,n=a.ordinal;c&&b.isArray(c)&&c.length===7&&(h=c),d&&b.isArray(d)&&d.length===7&&(i=d),e&&b.isArray(e)&&e.length===12&&(f=e),l&&b.isArray(l)&&l.length===12&&(g=l),m&&b.extend(j,m),n&&b.isFunction(n)&&(k=n)},date:function(a){return p(a)},formatDate:function(b,c){function t(b){var c,d;switch(b){case"M":return e+1;case"Mo":return e+1+k(e+1);case"MM":return l(e+1,2);case"MMM":return g[e];case"MMMM":return f[e];case"D":return j;case"Do":return j+k(j);case"DD":return l(j,2);case"DDD":c=new a(m,e,j),d=new a(m,0,1);return(c-d)/864e5+1.5|0;case"DDDo":c=t("DDD");return c+k(c);case"DDDD":return l(t("DDD"),3);case"d":return n;case"do":return n+k(n);case"ddd":return i[n];case"dddd":return h[n];case"w":c=new a(m,e,j-n+5),d=new a(c.getFullYear(),0,4);return(c-d)/864e5/7+1.5|0;case"wo":c=t("w");return c+k(c);case"ww":return l(t("w"),2);case"YY":return(m+"").slice(-2);case"YYYY":return m;case"a":return o>11?"pm":"am";case"A":return o>11?"PM":"AM";case"H":return o;case"HH":return l(o,2);case"h":return o%12||12;case"hh":return l(o%12||12,2);case"m":return q;case"mm":return l(q,2);case"s":return r;case"ss":return l(r,2);default:return b.replace("\\","")}}var d=p(b),e=d.getMonth(),j=d.getDate(),m=d.getFullYear(),n=d.getDay(),o=d.getHours(),q=d.getMinutes(),r=d.getSeconds(),s=/(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?)/g;return c.replace(s,t)},fromNow:function(a,b){var c=e.msApart(a,b),d=c<0?j.past:j.future;return d.replace(/%s/i,e.relativeTime(c))},isLeapYear:function(a){var b=!isNaN(a)&&a<1e4?a:p(a).getFullYear();return b%4===0&&b%100!==0||b%400===0},msApart:function(a,b){return o(a)-o(b)},now:function(b){return b?(new a).getTime():new a},relativeTime:function(a){var b=Math.abs(o(a))/1e3,c=b/60,d=c/60,e=d/24,f=e/365;return b<45&&q("s",b|0)||b<90&&q("m")||c<45&&q("mm",c|0)||c<90&&q("h")||d<24&&q("hh",d|0)||d<48&&q("d")||e<30&&q("dd",e|0)||e<60&&q("M")||e<350&&q("MM",e/30|0)||f<2&&q("y")||q("yy",f|0)},subtractTime:function(a,b){return m(b,p(a),-1)}},b&&b.mixin&&b.mixin(e)})(Date,_)
