// Underscore.date
//
// (c) 2011 Tim Wood
// Underscore.date is freely distributable under the terms of the MIT license.
//
// Version 0.3.1

(function(a,b,c){function t(a){var b=Math.abs(a)/1e3,c=b/60,d=c/60,e=d/24,f=e/365;return b<45&&q("s",b|0)||b<90&&q("m")||c<45&&q("mm",c|0)||c<90&&q("h")||d<24&&q("hh",d|0)||d<48&&q("d")||e<25&&q("dd",e|0)||e<45&&q("M")||e<350&&q("MM",(e+15)/30|0)||f<2&&q("y")||q("yy",f|0)}function s(a,b){return o(a)-o(b)}function r(a){this.date=p(a);return this}function q(a,b){return j[a].replace(/%d/i,b||1)}function p(d){return d===c?new a:d instanceof r?d.date:b.isDate(d)?d:b.isArray(d)&&d.length>2?n(d):new a(d)}function o(d){return d===c?(new a).getTime():isNaN(d)?d instanceof r?d.date.getTime():b.isDate(d)?d.getTime():b.isArray(d)&&d.length>2?n(d).getTime():(new a(d)).getTime():d}function n(b){return new a(b[0],b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0)}function m(b,c,d){var e=b.date,f=(c.ms||0)+(c.s||0)*1e3+(c.m||0)*6e4+(c.h||0)*36e5+(c.d||0)*864e5+(c.w||0)*6048e5,g=(c.M||0)+(c.y||0)*12,h;f&&e.setMilliseconds(e.getMilliseconds()+f*d),g&&(h=e.getDate(),e.setDate(1),e.setMonth(e.getMonth()+g*d),e.setDate(Math.min((new a(e.getFullYear(),e.getMonth()+1,0)).getDate(),h)));return b}function l(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}var d=this,e,f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],j={future:"in %s",past:"%s ago",s:"less than a minute",m:"about a minute",mm:"%d minutes",h:"about an hour",hh:"about %d hours",d:"a day",dd:"%d days",M:"about a month",MM:"%d months",y:"about a year",yy:"%d years"},k=function(a){var b=a%10;return(a%100/10|0)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"};r.prototype.format=function(b){function r(b){var c,q;switch(b){case"M":return d+1;case"Mo":return d+1+k(d+1);case"MM":return l(d+1,2);case"MMM":return g[d];case"MMMM":return f[d];case"D":return e;case"Do":return e+k(e);case"DD":return l(e,2);case"DDD":c=new a(j,d,e),q=new a(j,0,1);return(c-q)/864e5+1.5|0;case"DDDo":c=r("DDD");return c+k(c);case"DDDD":return l(r("DDD"),3);case"d":return m;case"do":return m+k(m);case"ddd":return i[m];case"dddd":return h[m];case"w":c=new a(j,d,e-m+5),q=new a(c.getFullYear(),0,4);return(c-q)/864e5/7+1.5|0;case"wo":c=r("w");return c+k(c);case"ww":return l(r("w"),2);case"YY":return(j+"").slice(-2);case"YYYY":return j;case"a":return n>11?"pm":"am";case"A":return n>11?"PM":"AM";case"H":return n;case"HH":return l(n,2);case"h":return n%12||12;case"hh":return l(n%12||12,2);case"m":return o;case"mm":return l(o,2);case"s":return p;case"ss":return l(p,2);default:return b.replace("\\","")}}var c=this.date,d=c.getMonth(),e=c.getDate(),j=c.getFullYear(),m=c.getDay(),n=c.getHours(),o=c.getMinutes(),p=c.getSeconds(),q=/(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?)/g;return b.replace(q,r)},r.prototype.add=function(a){return m(this,a,1)},r.prototype.subtract=function(a){return m(this,a,-1)},r.prototype.customize=function(a){var c=a.weekdays,d=a.weekdaysShort,e=a.months,l=a.monthsShort,m=a.relativeTime,n=a.ordinal;c&&b.isArray(c)&&c.length===7&&(h=c),d&&b.isArray(d)&&d.length===7&&(i=d),e&&b.isArray(e)&&e.length===12&&(f=e),l&&b.isArray(l)&&l.length===12&&(g=l),m&&b.extend(j,m),n&&b.isFunction(n)&&(k=n)},r.prototype.from=function(a,b,c){var d=s(this.date,a),e=d<0?j.past:j.future;return c?d:b?t(d):e.replace(/%s/i,t(d))},r.prototype.fromNow=function(a,c){return this.from(b.now(),a,c)},r.prototype.isLeapYear=function(){return b.isLeapYear(this.date.getFullYear())},e={date:function(a){return new r(a)},now:function(b){return b?(new a).getTime():e.date()},isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0}},b&&b.mixin&&b.mixin(e)})(Date,_)
